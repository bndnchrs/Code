% Ocean_Forcing
% At each timestep this code calculates the tendencies from the ocean. 

% This generally matters when ADVECT.DO = 1
% This means that ice is advected by the ocean
% currents. Therefore we calculate what the advective velocities in the ice
% are, induced by the ocean currents that we prescribe, using a very simple
% rheology. 


if ADVECT.DO
    
    % Here we use a prescribed ocean velocity field OCEAN.vel
    % And a prescribed shear
    
    ADVECT.Hmean_in = integrate_FD(ADVECT.FSTD_in,[FSTD.H FSTD.H_max_i],1);
    ADVECT.conc_in = sum(ADVECT.FSTD_in(:)); 

    
    ADVECT.oc_to_ic = OPTS.ociccoeff * (OPTS.H_0/FSTD.Hmean) * ( 1 - exp(-(1 + OPTS.ocicbeta - FSTD.conc)/OPTS.ocicdelta));
    
    
    % The reduction in ocean strain rate for the current grid cell
    % The reduction in ocean strain rate for the neighboring grid cell
    
    ADVECT.in_oc_to_ic = OPTS.ociccoeff * (OPTS.H_0/ADVECT.Hmean_in) * ( 1 - exp(-(1 + OPTS.ocicbeta - ADVECT.conc_in)/OPTS.ocicdelta));
    
    if MECH.DO
        
        Need to figure out why i did this
    
        OCEAN.v2 = 0; % OCEAN.Vvel(2,FSTD.i) * ADVECT.oc_to_ic;
    
    else
        
        OCEAN.v2 = OCEAN.Uvel(FSTD.i) * ADVECT.oc_to_ic;
    end
    
    OCEAN.v1 = OCEAN.vel(1,FSTD.i) * ADVECT.in_oc_to_ic;
    
    
    
else
    
    % We have OCEAN.StrainInvar
    
    if ~isfield(OCEAN,'StrainInvar') 
        error('No advection but also no prescribed strain invariants. This is bad!')
    end
    
end